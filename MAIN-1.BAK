#include<string.h>
#include<conio.h>
#include<iostream.h>
#include<fstream.h>
#include<stdio.h>
#include<stdlib.h>
#include<iomanip.h>
#include<process.h>
#include<dos.h>
#include<ctype.h>
#include<math.h>
char date,timee,loc[20],nun[25],name[30],scrn[12];
int w=0;
class user
{
 public:
 long int N;
 char movie[30];
 char scrn[12];
 int scrnno;
 int seat;
 char loc[20];
 char thea[25];
 char a[50][50];
 int in,jn;
 int date;
 int timee;
 char Paid;
 char lang[10];
 int status;
 int amount;
 user()
 {
  status=0;
 }
}u,u2,u3;
class acc
{
 char un[25];
 char pw[25];
 char cn[25];
 public:
 int signup();
 int login(int k);
 int enter(int i);
 int check(char temp[25]);
}l,l2,s,s2,c,t,t2,a;
class theatre
{
 public:
 int no;
 char loc[20];
 char name[20];
}A;
class ml
{
 char name[30];
 public:
 char * retmovie()
 {
  return name;
 }
 void display()
 {
  puts(name);
 }
}M,M2,M3;
class mldb
{
 char code[100],name[100],lang[100],desp[500],dura[100];
 public:
 void enter();
 void display(int i);
 char * retcode()
 {
  return code;
 }
 char * retname()
 {
  return name;
 }
 void language();
}m,m2,m3,m4,m5,m6;
class order
{
 public:
 long int N;
}o,p;
void load(int i)
{
 int n=0;
 clrscr();
 while(n<2)
 {
  clrscr();
  cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t    ";
  if(i==0)
   cout<<"Loading";
  if(i==1)
   cout<<"\b\b\bLogging in";
  if(i==2)
   cout<<"\b\bSigning Out";
  if(i==3)
   cout<<"Exiting";
  if(i==4)
   cout<<"\b\bReturning";
  for(int j=0;j<3;j++)
  {
   cout<<".";
   delay(375);
  }
  n++;
 }
}
int input(char c[25],int i=0)
{
 for(int j=0;j>=0;)
  {
   char temp=getch();
   if((int)temp==27)
    return -1;
   if(j==0)
   {
    if(temp=='\r')
    {
     return 0;
    }
    if(temp=='\b')
    {
     continue;
    }
   }
   if(temp!='\r'&&temp!='\b')
   {
    if(i==1)
     cout<<"*";
    if(i==0)
     cout<<temp;
    c[j]=temp;
    j++;
   }
   else if(temp=='\b')
   {
    cout<<"\b \b";
    j--;
   }
   else if(temp=='\r')
   {
    c[j]='\0';
    j=-1;
   }
  }
 return 1;
}
int acc::check(char temp[25])
{
 fstream file;char dummy;
 file.open("ACC.dat",ios::in|ios::binary);
 while(file.read((char*)&c,sizeof(c)))
 {
  file.get(dummy);
  if(strcmp(c.un,temp)==0)
  {
   cout<<"\n\n\t\t      This Username name is not available..";
   cout<<"\n\n\t\t                  Try again!";
   getch();
   file.close();
   return 0;
  }
 }
 return 1;
}
int acc::enter(int i)
{
 int j,e1=0,e2=0;
 char temp;
 en:
 clrscr();
 if(i==0)
 {
   cout<<"\t\t\t\t   Login Window\n";
   cout<<"\t\t\t   (Press 'Escape' to go back)\n\n\n";
 }
 if(i==1)
 {
  cout<<"\t\t\t\t  Signup Window\n";
  cout<<"\t\t\t    (Press 'Escape' to go back)\n\n";
 }
 if(i==2)
 {
  cout<<"\t\t\t\t << Admin Access >>\n\n";
  i=0;
 }
 cout<<"\n\n\n\n\n\n\n\n\t\t         Enter Your Username: ";
 if(e1==1)
  puts(un);
 if(e1==0)
 {
  j=input(un);
  if(j==0)
   goto en;
  if(j==-1)
   return 0;
  if(strlen(un)==0)
  {
   cout<<"\nWrong Input!\nEnter again";
   getch();
   goto en;
  }
  if(i==1)
  {
   j=check(un);
   if(!j)
    goto en;
  }
  e1=1;
 }
 if(j!=0&&e2==0)
  cout<<endl;
 cout<<"\t\t         Enter Your Password: ";
 if(i==1&&e2!=1)
 {
  textcolor(DARKGRAY);
  cputs("(Atleast 8 characters)");
  delay(1200);
  textcolor(LIGHTGRAY);
  for(int k=0;k<22;k++)
  {
   textcolor(LIGHTGRAY);
   cputs("\b");
  }
  for(k=0;k<22;k++)
  {
   textcolor(LIGHTGRAY);
   cputs(" ");
  }
  for(k=0;k<22;k++)
  {
   textcolor(LIGHTGRAY);
   cputs("\b");
  }
 }
 if(e2==1)
 {
  for(j=0;j<strlen(pw);j++)
  {
   cout<<"*";
  }
 }
 if(e2==0)
 {
  j=input(pw,1);
  if(j==0)
   goto en;
  if(j==1);
   e2=1;
  if(j==-1)
   return 0;
 }
 if(i==1)
 {
  cout<<"\n\t\t         Enter your Phone No: ";
  j=input(cn);
  if(j==0)
   goto en;
  if(j==-1)
   return 0;
  if(strlen(cn)!=10)
  {
   cout<<"\nWrong Input!\nEnter again";
   getch();
   goto en;
  }
  for(j=0;j<strlen(cn)-1;j++)
  {
   if(!isdigit(cn[j]))
   {
    cout<<"\nWrong Input!\nEnter again";
    getch();
    goto en;
   }
  }
 }
 return 1;
}
int acc::login(int k=0)
{
 int j,i=1;
 char dummy;
 if(k==0)
  j=enter(0);
 if(k==1)
  j=enter(2);
 if(j==0)
  return 0;
 if(k==0)
 {
  fstream file;
  file.open("ACC.dat",ios::in|ios::binary);
  while(file.read((char*)&t,sizeof(t)))
  {
   file.get(dummy);
   if(strcmp(t.un,un)==0)
   {
    i=0;
    if(strcmp(t.pw,pw)==0)
     cout<<"\nLogged in!";        //doesnt get displayed
    else
    {
     cout<<"\n\n\t\t\t Entered the wrong password!";
     getch();
     return 0;
    }
   }
  }
  if(i!=0)
  {
   cout<<"\n\n\t\t\t Entered the wrong Username!";
   getch();
   return 0;
  }
  file.close();
  load(1);
  strcpy(::nun,un);
  strcpy(::name,un);
  for(i=0;;i++)
  {
   if(::name[i]=='\0')
   {
    ::name[i++]='.';
    ::name[i++]='d';
    ::name[i++]='a';
    ::name[i++]='t';
    ::name[i++]='\0';
    break;
   }
  }
 }
 if(k==1)
 {
  int s=0;
  if(strcmp(un,"admin")==0&&strcmp(pw,"HRCword")==0)
  {
   s=1;
  }
  if(s==1)
  {
   load(0);
   return 1;
  }
  if(s==0)
  {
   cout<<"\n\n\t\t\t   Entered wrong credentials!";
   getch();
   return 0;
  }
 }
 return 1;
}
int acc::signup()
{
 int j=t2.enter(1);
 if(j==0)
  return 0;
 fstream file;
 file.open("ACC.dat",ios::out|ios::app|ios::binary);
 file.write((char*)&t2,sizeof(t2));
 file<<endl;
 file.close();
 cout<<"\n\n\n\n\t\t\t     Successfully Registered!";
 strcpy(::nun,t2.un);
 strcpy(::name,t2.un);
  for(int i=0;;i++)
 {
  if(::name[i]=='\0')
  {
   ::name[i++]='.';
   ::name[i++]='d';
   ::name[i++]='a';
   ::name[i++]='t';
   ::name[i++]='\0';
   break;
  }
 }
 return 1;
}
void payment(int se)
{
 char c,cvv[4],holder[35],cardno[20];
 int exp,choice,tax=84,phon,ph,bill;
 fstream f;
 clrscr();
 u.amount=bill=se*140+tax;
 strcpy(u.scrn,::scrn);
 u.date=::date-48;
 u.timee=::timee-48;
 strcpy(u.loc,::loc);
 cout<<"Please enter the mode of payment \n";
 cout<<"1. Debit Card\n";
 cout<<"2. Credit Card \n";
 cout<<"3. Pay at the Theatres \n";
 cout<<"0. Exit";
 cin>>choice;
 int cn=0,exd=0,cv=0;
 switch(choice)
 {
  case 1:
  case 2:g:
	 clrscr();
	 cout<<"Please fill up the following credentials\n\n";
	 cout<<"Enter the Card number without leaving spaces \n";
	 if(cn==0)
	 {
	  gets(cardno);
	  if(strlen(cardno)!=16)
	  {
	   cout<<"\nInvalid input!";
	   delay(1000);
	   goto g;
	  }
	  for(int i=0;i<strlen(cardno)-1;i++)
	  {
	   if(!isdigit(cardno[i]))
	   {
	    cout<<"\nInvalid Input!";
	    delay(900);
	    goto g;
	   }
	  }
	 }
	 if(cn==1)
	  puts(cardno);
	 cn=1;
	 cout<<"\nEnter the expiry date of card in MM YY format \n";
	 if(exd==0)
	 {
	  cin>>exp;

	 }
	 if(exd==1)
	  cout<<exp<<endl;
	 exd=1;
	 cout<<"\nPlease enter the CVV number\n";
	 if(cv==0)
	 {
	 for(int j=0;j>=0;)
	 { c=getch();
	 if(c!='\r'&&c!='\b')
     {if(c!='\r'&&c!='\n'){
   {
     cout<<"*";
    cvv[j]=c;
    j++;                   }}
   }
   else if(c=='\b')
   {
    cout<<"\b \b";
    j--;
   }
   else if(c=='\r')
   {
    cvv[j]='\0';
    j=-1;
   }
	 }}
	 if(cv==1)
	  cout<<"***";
	 cv=1;
	 cout<<"\nEnter your card holder name \n";
	  for(int j=0;j>=0;)
	 { c=getch();
	 if(c!='\r'&&c!='\b')
   {
    if(!isalpha(c))
    {
     j=-1;
     cout<<"\nInvalid Input!";
     delay(900);
     goto g;
    }
    if(islower(c))
     toupper(c);
    cout<<c;
    holder[j]=c;
    j++;
   }
   else if(c=='\b')
   {
    cout<<"\b \b";
    j--;
   }
   else if(c=='\r')
   {

    holder[j]='\0';
    j=-1;
   }
	 }
	 if(strlen(holder)==0)
	 {
	  cout<<"\nInvalid Input";
	  delay(1000);
	  goto g;
	 }
	 clrscr();
	 f.open("ORDER.dat",ios::in|ios::binary);
	 while(f.read((char*)&o,sizeof(o)))
	 {
	  p.N=o.N+1;
	 }
	 u.N=p.N;
	 f.close();
	 f.open("ORDER.dat",ios::app|ios::binary);
	 f.write((char*)&p,sizeof(p));
	 f.close();
	 cout<<"\n\n\n";
	 cout<<"\t\t  ::::::::::::::::::::::::::::::::::::::::::::::  \n";
	 cout<<"\t\t                    Bill Created                   \n";
	 cout<<"\t\t      Order No: "<<p.N<<endl;
	 cout<<"\t\t      Location: ";puts(u.loc);
	 cout<<"\t\t      MOVIE: ";puts(u.movie);
	 cout<<"\t\t      LANGUAGE: ";puts(u.lang);
	 cout<<"\t\t      THEATRE: ";puts(u.thea);
	 cout<<"\t\t      Total Seats: "<<u.seat<<endl;
	 cout<<"\t\t      Seats: ";
	 for(int i=0;i<u.in;i++)
	 {
	  for(int j=0;j<u.jn;j++)
	  {
	   if(u.a[i][j]=='*')
	    cout<<char((j/2)+65)<<(i+1)<<",";
	  }
	 }cout<<"\b \b\n";
	 cout<<"\t\t      Value added Tax            :  $10.00              \n";
	 cout<<"\t\t                 CGST            :  $12.00              \n";
	 cout<<"\t\t                 SGST            :  $12.00              \n";
	 cout<<"\t\t      Internet Booking charges   :  $50.00              \n";
	 cout<<"\t\t      Total Tickets Pric         : $"<<se*140<<".00"<<endl;
	 cout<<"\t\t      Total incured Bill         : $"<<bill<<".00"<<endl;
	 cout<<"\t\t      Payment Status             : Paid"<<endl;
	 cout<<"\t\t  ::::::::::::::::::::::::::::::::::::::::::::::  ";
	 u.Paid='Y';
	 break;
  case 3:clrscr();
	 cout<<"For Payment at the Theatres   \n";
	 cout<<"PLease Show the Below code at the Counterzone to get the bill and Ticket \n";
	 cout<<(rand()%999)+1000<<endl;
	 cout<<"Please Make sure to give your number for confirmation of the ticket \n";
	 f.open("ORDER.dat",ios::in|ios::binary);
	 while(f.read((char*)&o,sizeof(o)))
	 {
	  p.N=o.N+1;
	 }
	 u.N=p.N;
	 f.close();
	 f.open("ORDER.dat",ios::app|ios::binary);
	 f.write((char*)&p,sizeof(p));
	 f.close();
	 cout<<"\n\n";
	 cout<<"\t\t  ::::::::::::::::::::::::::::::::::::::::::::::  \n";
	 cout<<"\t\t                    Bill Created                   \n";
	 cout<<"\t\t      Order No: "<<p.N;cout<<endl;
	 cout<<"\t\t      Location: ";puts(u.loc);
	 cout<<"\t\t      MOVIE: ";puts(u.movie);
	 cout<<"\t\t      LANGUAGE: ";puts(u.lang);
	 cout<<"\t\t      THEATRE: ";puts(u.thea);
	 cout<<"\t\t      Total Seats: "<<u.seat<<endl;
	 cout<<"\t\t      Seats: ";
	 for(i=0;i<u.in;i++)
	 {
	  for(int j=0;j<u.jn;j++)
	  {
	   if(u.a[i][j]=='*')
	    cout<<char((j/2)+65)<<(i+1)<<",";
	  }
	 }cout<<"\b \b\n";
	 cout<<"\t\t      Value added Tax            :  $10.00              \n";
	 cout<<"\t\t                 CGST            :  $12.00              \n";
	 cout<<"\t\t                 SGST            :  $12.00              \n";
	 cout<<"\t\t      Internet Booking charges   :  $50.00              \n";
	 cout<<"\t\t      Total Tickets Pric         : $"<<se*140<<".00"<<endl;
	 cout<<"\t\t      Total incured Bill         : $"<<bill<<endl;
	 cout<<"\t\t      Payment Status             : Not paid"<<endl;
	 cout<<"\t\t  ::::::::::::::::::::::::::::::::::::::::::::::  ";
	 u.Paid='N';
	 break;
  case 0:exit(0);
  default:cout<<"\n\nInvalid code entered \n";

 }
 u.status=1;
 f.open(::name,ios::out|ios::app|ios::binary);
 f.write((char*)&u,sizeof(u));
 f.close();
 getch();
 clrscr();
 cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t<< Enjoy your Show "<<char(2)<<"! >>";
 getch();
}
void array(char a[50][50],int in,int jn,int x,int &count,int total)
{
 int i=0,j=0,k=0;
 clrscr();
 cout<<"\n    ";
 for(j=65;j<65+((jn+1)/2);j++)
  cout<<(char)j<<" ";
 cout<<"       * : Booked Seat";
 cout<<endl;
 for(i=0;i<in;i++)
 {
  cout<<setw(2)<<i+1<<"  ";
  for(j=0;j<jn;j++)
  {
   cout<<a[i][j];
   if(i==0&&j==(jn-1))
    cout<<"        - : Available Seat";
   if(i==1&&j==(jn-1))
    cout<<"        # : Selected Seat";
   if(i==(in-2)&&j==(jn-1))
   {
    if(x==0)
     cout<<"        Seats Selected:"<<count<<"/"<<total;
    if(x==1)
     cout<<"        Total: "<<total;
   }
  }cout<<endl;
 }cout<<"    ";
 for(k=0;k<jn;k++)
  cout<<"-";
 cout<<"SCREEN"<<endl;
}
int seatselect()
{
 fstream sf,sf2;
 sf2.open(::scrn,ios::in);
 char tempc3,tempc4;
 char a[50][50],len[50],s,c,c1,ch,temps[100],tempssa[100],tempN[100],tempsn[100];
 int i=0,j=0,k=0,l=0,n=0,N=0,in=0,abc,count=0,count2=0/*,count3=0*/,total=0,x,y=0,z=0,sn=0,ab=0,jn,jnn[50];
 while(!sf2.eof())
 {
  sf2.getline(len,50);
  jnn[i++]=strlen(len);
  in++;
 }
 jn=jnn[0];
 sf2.close();
 sf.open(::scrn,ios::in);
 u.in=in;
 u.jn=jn;
 for(i=0;i<in;i++)
  {
   for(j=0;j<jn;j++)
   {
    u.a[i][j]='$';
    sf.get(c1);
    if(c1!='\n')
     a[i][j]=c1;
    else
     {
      sf.get(c1);
      a[i][j]=c1;
     }
    if(a[i][j]=='-')
     count2++;
   }
  }
 sf.close();
 do
 {
  here1:
  n=0;
  do
  {
   heree:
   N=y=0;
   clrscr();
   cout<<"Screen No: "<<u.scrnno;
   cout<<"\nAvailable Seats: "<<count2;
   cout<<"\nEnter the number of tickets you want to book:";
   gets(tempN);
   if(strlen(tempN)>0&&strlen(tempN)<=3)
   {
    for(i=0;i<strlen(tempN);i++)
    {
     if(!isdigit(tempN[i]))
     {
      y=1;
      i=strlen(tempN);
     }
    }
    if(y==1)
    {
     cout<<"\nInvalid Input!\nEnter again";
     delay(1200);
     goto heree;
    }
    if(y==0)
    {
     z=0;
     for(i=strlen(tempN)-1;i>=0;i--)
     {
      N=N+(tempN[i]-48)*pow(10,z++);
     }
     if(N<0||N>count2)
     {
      if(N<0)
      {
       cout<<"\nInvalid Input! Enter Again";
       delay(500);
      }
      if(N>count2)
      {
       cout<<"\nLimit Exceeded!";
       delay(500);
      }
     }
     else if(N>0)
     {
      her:
      clrscr();
      cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t\b\b\b";
      if(N!=1)
       cout<<N<<" seats,Are you sure?(y/n)";
      if(N==1)
       cout<<" 1 seat, Are you sure?(y/n)";
      tempc3=getch();
      if(tempc3=='n'||tempc3=='N')
      {
       goto heree;
      }
      if(tempc3!='y'&&tempc3!='Y'&&tempc3!='n'&&tempc3!='N')
      {
       cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t\b\b";
       cout<<"Invalid Input!";
       delay(500);
       goto her;
      }
     }
    }
   }
   else
   {
    cout<<"\nInvalid Input!\nEnter again";
    delay(1200);
    clrscr();
    goto heree;
   }
  }while(N<0||N>count2);
  total+=N;


  if(N==0&&total!=0)
  {
   here2:
   cout<<"\nDont want to book anymore tickets?(y/n)";
   tempc3=getch();
   if(tempc3=='y'||tempc3=='Y')
   {
    goto here4;
   }
   else if(tempc3=='n'||tempc3=='N')
    {
    goto here1;
    }
   else
    {
     cout<<"\nInvalid Input! Enter Again";
     goto here2;
    }
  }
  else if(N==0&&total==0)
   {
    here3:
    cout<<"\nAre you sure you dont want to book any tickets?(y/n)";
    tempc3=getch();
    if(tempc3=='y'||tempc3=='Y')
     goto here;
    else if(tempc3=='n'||tempc3=='N')
     goto here1;
    else
     {
      cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\b\b";
      cout<<"Invalid Input! Enter Again";
      goto here3;
     }
   }
   if(N>=8)
   {
   do
  {
  ab=0;
   wass:
   clrscr();
   cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t";
   cout<<"Do you want to Autoselect seats?(y/n)";
   tempc3=getch();
   cout<<tempc3;
   wass2:
   cout<<"\n\n\t\t\t\t   Are you sure?(y/n): ";
   tempc4=getch();
   cout<<tempc4;
   if(tempc4=='y'||tempc4=='Y')
   {
   if(tempc3=='y'||tempc3=='Y')
   {
    ab=1;
   }
   if(tempc3=='n'||tempc3=='N')
   {
    ab=0;
   }
   if(tempc3!='y'&&tempc3!='Y'&&tempc3!='n'&&tempc3!='N')
   {
    cout<<"\n\n\t\t\t\b\b";
    cout<<"Invalid Input!\n\t\t\t\t    Enter Again";
   }
   }
   if(tempc4=='n'||tempc4=='N')
   {
    goto wass;
   }
   if(tempc4!='y'&&tempc4!='Y'&&tempc4!='n'&&tempc4!='N')
   {
    cout<<"\n\n\t\t\t\b\b";
    cout<<"Invalid input!\n\t\t\t\t  Enter again";
    clrscr();
    goto wass2;
   }
   }while(tempc3!='y'&&tempc3!='Y'&&tempc3!='n'&&tempc3!='N');
   }
     switch(ab)
  {
   case 0:ssa3:


  while(n<N&&N>0)
  {

   ss:
   z=x=0;
   array(a,in,jn,x,count,total);
   do
   {
    do
    {
     cout<<"\nEnter the Seat Number(like B7,H10): ";
     gets(temps);
     if(strlen(temps)>=2&&strlen(temps)<=3)
     {
      if(isalpha(temps[0])&&isupper(temps[0]))
      {
       s=temps[0];
      }
      if(!isalpha)
      {
       cout<<"\nInvalid Input!\nEnter again";
       delay(1200);
       goto ss;
      }
      for(i=1;i<strlen(temps);i++)
      {
       if(!isdigit(temps[i]))
       {
	z=1;
	i=strlen(temps);
       }
      }
      if(z==1)
      {
       cout<<"\nInvalid Input!\nEnter again";
       delay(1200);
       goto ss;
      }
      if(z==0)
      {
       sn=y=0;
       for(i=strlen(temps)-1;i>0;i--)
       {
	sn+=(temps[i]-48)*pow(10,y++);
       }
      }
     }
     if(strlen(temps)<2||strlen(temps)>3)
     {
      cout<<"\nInvalid input!\nEnter again";
      delay(1200);
      goto ss;
     }
     if(z==0)
     {
      if((s<65)||(s>=(65+((jn+1)/2)))||sn<=0||sn>in)
      {
       cout<<"\nInvlaid Input! Enter Again";
       delay(1500);
       x=0;
       array(a,in,jn,x,count,total);
      }
      if(a[sn-1][2*((s)-65)]=='#')
      {
       cout<<"\nYou already selected this seat!\nSelect another one...";
       delay(1500);
       x=0;
       array(a,in,jn,x,count,total);
      }
      if(a[sn-1][2*(((char)s)-65)]=='*')
      {
       cout<<"\nSeat is unavailable for booking!\nSelect another one...";
       delay(1500);
       x=0;
       array(a,in,jn,x,count,total);
      }
     }
    }while((s<65)||(s>=(65+((jn+1)/2)))||sn<=0||sn>in);
   }while(a[sn-1][2*(((char)s)-65)]=='#'||a[sn-1][2*(((char)s)-65)]=='*');
   count++;
   count2--;
   a[sn-1][2*(((char)s)-65)]='#';
   n++;
  }
  break;


  case 1: ssa2:
  while(n<N){ssa:
	  z=x=0;
	  array(a,in,jn,x,count,total);
	  do
   {
    do
    {
     cout<<"\nStart from Seat(like B7,H10): ";
     gets(temps);
     if(strlen(temps)>=2&&strlen(temps)<=3)
     {
      if(isalpha(temps[0])&&isupper(temps[0]))
      {
       s=temps[0];
      }
      if(!isalpha)
      {
       cout<<"\nInvalid Input!\nEnter again";
       delay(1200);
       goto ssa;
      }
      for(i=1;i<strlen(temps);i++)
      {
       if(!isdigit(temps[i]))
       {
	z=1;
	i=strlen(temps);
       }
      }
      if(z==1)
      {
       cout<<"\nInvalid Input!\nEnter again";
       delay(1200);
       goto ssa;
      }
      if(z==0)
      {
       sn=y=0;
       for(i=strlen(temps)-1;i>0;i--)
       {
	sn+=(temps[i]-48)*pow(10,y++);
       }
      }
     }
     if(strlen(temps)<2||strlen(temps)>3)
     {
      cout<<"\nInvalid input!\nEnter again";
      delay(1200);
      goto ssa;
     }
     if(z==0)
     {
      if((s<65)||(s>=(65+((jn+1)/2)))||sn<=0||sn>in)
      {
       cout<<"\nInvlaid Input!\nEnter Again";
       delay(1500);
       x=0;
       array(a,in,jn,x,count,total);
      }
      if(a[sn-1][2*((s)-65)]=='#')
      {
       cout<<"\nYou already selected this seat!\nSelect another one...";
       delay(1500);
       x=0;
       array(a,in,jn,x,count,total);
      }
      if(a[sn-1][2*(((char)s)-65)]=='*')
      {
       cout<<"\nSeat is unavailable for booking!\nSelect another one...";
       delay(1500);
       x=0;
       array(a,in,jn,x,count,total);
      }
     }
    }while((s<65)||(s>=(65+((jn+1)/2)))||sn<=0||sn>in);
   }while(a[sn-1][2*(((char)s)-65)]=='#'||a[sn-1][2*(((char)s)-65)]=='*');
   count++;
   count2--;
   a[sn-1][2*(((char)s)-65)]='#';
   n++;
   i=sn-1;
   j=2*(s-65);
   do
   {j++;
    if(j>=jn)
    {
     j=0;
     i++;
    }
    while(a[i][j]!='-')
    {
     j++;
     if(j>=jn)
     {
      j=0;
      i++;
     }
    }
    a[i][j]='#';
    n++;
    count++;
    count2--;
    if(i>=in)
    {
     n--;
     count2++;
     count--;
     x=0;
     array(a,in,jn,x,count,total);
     ssaa:
     cout<<"\nReached the end..";
     cout<<"\n1.Continue from A1";
     cout<<"\n2.Continue from other seat";
     cout<<"\n3.Select remaianing seats manually";
     gets(tempssa);
    if(strlen(tempssa)==1)
    {
     if(!isdigit(tempssa[0]))
     {
      cout<<"\nInvalid Input!\nEnter again";
      goto ssaa;
     }
     if(isdigit(tempssa[0]))
     {
      abc=tempssa[0]-48;
     }
     switch(abc)
     {
      case 1:i=0;j=-1;
	     break;
      case 2:goto ssa2;

      case 3:
	     goto ssa3;

      default:cout<<"\nInvalid Input!\nEnter again";
	      goto ssaa;
     }
    }

    else
    {
     cout<<"\nInvalid input!\nEnter again";
     goto ssaa;
    }
    }
   }while(n<N);
   }
	 break;
  }


   x=0;
   array(a,in,jn,x,count,total);
   here4:
   cout<<endl<<"Total No of Seats: "<<total;
   here5:
   cout<<endl<<"Seats booked: ";if(total==0){cout<<"NONE";}
   if(total!=0)
   {
    u.seat=0;
    for(i=0;i<in;i++)
    {
     for(j=0;j<jn;j++)
     {
      if(a[i][j]=='#')
      {
       cout<<((char)((j/2)+65))<<(i+1)<<",";
       u.a[i][j]='*';
       u.seat++;
      }
     }
    }cout<<"\b \b"<<endl;
   }

   here:

   cout<<"\nChoose:";
   cout<<"\n1.Proceed to payment";
   cout<<"\n2.Book more tickets";
   cout<<"\n3.Deselect seat";
   cout<<"\n4.Go Back To Main Menu";
   cout<<"\n0.Exit\n";
   cout<<"Enter your choice: ";
   ch=getch();
 if(ch=='\r'||int(ch)==27||ch=='\b')
 {
  clrscr();
  goto here4;
 }
 if((!isdigit(ch))||ch!='1'&&ch!='2'&&ch!='3'&&ch!='4'&&ch!='0')
 {
  clrscr();
   cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t  Invalid Input!\n";
   cout<<"\t\t\t\t   Enter again..";
   getch();
   clrscr();
   goto here4;
 }
   char newtemp;
   switch(ch)
   {
    case '1':do
	   {
	    if(total>0)
	    {
	    clrscr();
	    cout<<"\n\n\n\n\n\n\n\n\n\n\n\t        ";
	    cout<<"Sure that you want to proceed to payment window?(y/n)";
	    newtemp=getch();
	    if(newtemp=='y'||newtemp=='Y')
	    {
	     if(::w==0)
	     {
	      clrscr();
	      cout<<"\n\n\n\n\n\n\n\n\n\n\n\t       ";
	      cout<<"Please Login or Signup before proceeding to transcation!";
	      getch();
	      load(0);

 char oc[2]={4,'\0'},ch;
 ls:
 clrscr();
 cout<<"\t\t\t        ";
  textbackground(WHITE);
  textcolor(BLACK);
  cputs(oc);
  cputs(" ORIENTAL CINEMAS ");
  cputs(oc);
  textbackground(BLACK);
  textcolor(LIGHTGRAY);
 cout<<"\n\n\n\n\n\n\n\n\n\n";
 cout<<"\t\t\t\t    1.Login\n";
 cout<<"\t\t\t\t    2.Signup\n";
 cout<<"\t\t\t\t    0.Exit";
 textcolor(LIGHTGRAY);
 ch=getch();
 if(ch=='\r'||int(ch)==27||ch=='\b')
 {
  goto ls;
 }
 if(!isdigit(ch)||ch!='1'&&ch!='2'&&ch!='0')
 {
  clrscr();
  cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t  Invalid Input!\n";
  cout<<"\t\t\t\t   Enter again..";
  getch();
  goto ls;
 }
  switch(ch)
  {
     case '1':i=l2.login();
	      if(i==0)
		goto ls;
	      if(i==1)
	       ::w=1;
	      break;
     case '2':i=s2.signup();
	      if(i==0)
	       goto ls;
	      if(i==1)
	      {
	       ::w=1;
	       getch();
	      }
	      break;
     case '0':load(3);
	      exit(0);
 }
  }


	    if(::w==1)
	     {k=0;
	    while(k<1)
	    {
	     clrscr();
	     cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t  Proceeding to Payment Window";
	     for(l=0;l<3;l++)
	     {
	      cout<<".";
	      delay(500);
	     }
	     k++;
	    }
	     payment(total);
	     sf.open("tscrn.txt",ios::out);
	     sf2.open(::scrn,ios::in|ios::binary) ;
	     for(i=0;i<in;i++)
	     {
	      for(j=0;j<jn;j++)
	      {
	       if(a[i][j]=='#')
		a[i][j]='*';
	       sf.put(a[i][j]);
	      }
	      if(i!=(in-1))
	       sf<<endl;
	     }
	     sf.close();
	     sf2.close();
	     remove(::scrn);
	     rename("tscrn.txt",::scrn);
	    }
	    }
	    if(newtemp=='n'||newtemp=='N')
	    {
	     x=1;
	     array(a,in,jn,x,count,total);
	     goto here5;
	    }
	    if(newtemp!='n'&&newtemp!='N'&&newtemp!='y'&&newtemp!='Y')
	    {
	     cout<<"\n\n\t\t\t\t   Invalid input!\n\t\t\t\t    Enter again";
	     delay(900);
	    }
	    }
	    if(total==0)
	     {
	      cout<<"First book some tickets";
	      delay(1200);
	      clrscr();
	      goto here4;
	     }
	   }while(newtemp!='n'&&newtemp!='N'&&newtemp!='y'&&newtemp!='Y');
	   break;
   case '2':if(count2>0);
	    {
	     x=0;
	     clrscr();
	    }
	    if(count2==0)
	    {
	     cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t";
	     cout<<"No Seats Available!";
	     delay(900);
	     clrscr()
	     goto here4;
	    }
	    break;
   case '3':do
	  {
	   if(total>0)
	   {
	   clrscr();
	   cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t    ";
	   cout<<"Do you really want to deselect a seat?(y/n)";
	   newtemp=getch();
	   if(newtemp=='y'||newtemp=='Y')
	   {

	     do
	     {dss:
	      z=0;
	      x=1;
	      clrscr();
	      cout<<"Seats booked: ";
	      for(i=0;i<in;i++)
	      {
	       for(j=0;j<jn;j++)
	       {
		if(a[i][j]=='#')
		cout<<((char)((j/2)+65))<<(i+1)<<",";
	       }
	      }cout<<"\b \b"<<endl;
	       cout<<"\nEnter the Seat No(like B7,H10): ";
	       gets(temps);
	       if(strlen(temps)>=2&&strlen(temps)<=3)
	       {
		if(isalpha(temps[0])&&isupper(temps[0]))
		{
		 s=temps[0];
		}
		if(!isalpha(temps[0]))
		{
		 cout<<"\nInvalid Input\nEnter again";
		 delay(1200);
		 clrscr();
		 goto dss;
		}
		for(i=1;i<strlen(temps);i++)
		{
		 if(!isdigit(temps[i]))
		 {
		  z=1;
		  i=strlen(temps);
		 }
	       }
	       if(z==1)
	       {
		cout<<"\nInvalid Input!\nEnter again";
		delay(1200);
		clrscr();
		goto dss;
	       }
	       if(z==0)
	       {
	       sn=y=0;
	       for(i=strlen(temps)-1;i>0;i--)
	       {
		sn+=(temps[i]-48)*pow(10,y++);
	       }

	       }
	       }
	       if(strlen(temps)<2||strlen(temps)>3)
	       {
		cout<<"\nInvalid Input\nEnter again";
		delay(1200);
		clrscr();
		goto dss;
	       }
	       if(z==0)
	       {
	      if(((char)s<65)||((char)s>=(65+((jn+1)/2)))||sn<=0||sn>in)
	      {cout<<"\n\t\t\t\t  Invlaid Input!\n    Enter Again";
	      delay(1200);
	      }
	     }
	     }while((s<65)||(s>=(65+((jn+1)/2)))||sn<=0||sn>in);
	     if(a[sn-1][2*(((char)s)-65)]=='#')
	     {
	      a[sn-1][2*(((char)s)-65)]='-';
	      total--;
	      count2++;
	     }
	     else
	     {
	      cout<<"\nYou didn't select this seat";
	      delay(1500);
	     }
	     x=1;
	     array(a,in,jn,x,count,total);
	     goto here5;
	    }
	   }
	    else if(total==0)
	    {cout<<"First Book Some Tickets";
	     delay(1200);
	     clrscr();
	     goto here4;
	     }
	   if(newtemp=='n'||newtemp=='N')
	   {
	    x=1;
	    array(a,in,jn,x,count,total);
	    goto here5;
	   }
	   if(newtemp!='n'&&newtemp!='N'&&newtemp!='y'&&newtemp!='Y')
	   {
	    cout<<"Invalid input";
	    delay(1300);
	   }
	  }while(newtemp!='n'&&newtemp!='N'&&newtemp!='y'&&newtemp!='Y');
	  break;
   case '4':return 0;
   case '0':do
	  {
	   clrscr();
	   cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\b\b    ";
	   cout<<"Do you really want to exit?(y/n)";
	   newtemp=getch();
	   if(newtemp=='y'||newtemp=='Y')
	   {
	    if(::w==1)
	     load(2);
	    load(3);

	   k=0;
	   exit(0);
	   }
	   if(newtemp=='n'||newtemp=='N')
	   {
	    x=1;
	    array(a,in,jn,x,count,total);
	    goto here5;
	   }
	   if(newtemp!='n'&&newtemp!='N'&&newtemp!='y'&&newtemp!='Y')
	   {
	    cout<<"\n\n\t\t\t\t  Invalid input!\n\t\t\t\t   Enter again";
	    delay(1300);
	   }

	  }while(newtemp!='n'&&newtemp!='N'&&newtemp!='y'&&newtemp!='Y');
	   break;
  }
 }while(ch=='2');
 return 1;
}
void mldb::enter()
{
 fstream fobj,fobj2;
 char dummy;
 encode:
 clrscr();
 cout<<"Enter the Movie code(only numericals): ";
 gets(code);
 for(int i=0;i<strlen(code)-1;i++)
 {
  if(!isdigit(code[i]))
  {
   cout<<"\nInvalid Input!\nEnter Again";
   getch();
   goto encode;
  }
 }
 fobj.open("ldb.dat",ios::in|ios::binary);
 if(fobj)
 {
  while(fobj.read((char*)&m5,sizeof(m5)))
  {
   fobj.get(dummy);
   if(strcmp(code,m5.code)==0)
   {
    cout<<"\nMovie code is already in use!\nEnter again";
    getch();
    fobj.close();
    goto encode;
   }
  }
 }
 enmov:
 clrscr();
 cout<<"Enter the Movie Name: ";
 gets(name);
 fobj2.open("ldb.dat",ios::in|ios::binary);
 if(fobj2)
 {
  while(fobj2.read((char*)&m6,sizeof(m6)))
  {
   fobj2.get(dummy);
   if(strcmpi(m6.name,name)==0)
   {
    cout<<"\nMovie is already in the list\nEnter again";
    getch();
    fobj2.close();
    goto enmov;
   }
  }
 }
 clrscr();
 cout<<"Enter Language(like Hindi,English): ";
 gets(lang);
 clrscr();
 cout<<"Enter description: ";
 gets(desp);
 endura:
 clrscr();
 cout<<"Enter Duration of the Movie in mins(min 100,max 220): ";
 gets(dura);
 if(strlen(dura)!=3)
 {
  cout<<"\nInvalid Input!\nEnter again";
  getch();
  goto endura;
 }
 for(i=0;i<strlen(dura)-1;i++)
 {
  if(!isdigit(dura[i]))
  {
   cout<<"\nInvalid input!\nEnter again";
   getch();
   goto endura;
  }
 }
 if(dura[0]-48>2||dura[0]-48==0)
 {
  cout<<"\nDuration is not acceptable!\nEnter again";
  getch();
  goto endura;
 }
 if(dura[0]-48==2)
 {
  if(dura[0]-48==2)
  {
   if(dura[0]-48>0)
   {
    cout<<"\nDuration is not acceptable\nEnter again";
    getch();
    goto endura;
   }
  }
 }
}
void mldb::display(int i=0)
{
 textcolor(YELLOW);
 cputs(name);
 cout<<endl;
 textcolor(LIGHTBLUE);
 if(i==0)
  cputs(code);
 if(i==1)
 {
  int t=0;
  int z=0;
  for(int j=strlen(dura)-1;j>=0;j--)
  {
   t=t+(dura[j]-48)*pow(10,z++);
  }
  char ch[8]={(t/60)+48,'h',' ',((t%60)/10)+48,((t%60)%10)+48,' ','m','\0'};
  cputs(ch);
 }
 cout<<endl;
 textcolor(WHITE);
 cputs(desp);
 cout<<endl;
 if(i==0)
 {
  textcolor(DARKGRAY);
  cputs(dura);
  cout<<endl;
 }
 textcolor(LIGHTCYAN);
 cputs(lang);
 cout<<endl<<endl;
 textcolor(LIGHTGRAY);
}
void mldb::language()
{
 int k=0,count=0,n,j;
 char c[][10]={"  ","  ","  ","  ","  ","  ","  ","  ","  ","  "},tc[10];
  elang:
 clrscr();
  strcpy(tc,"\0");
 n=1;j=0;
 count=1;
 cout<<n<<".";
 for(int i=0;i<strlen(lang);i++)
 {
  if(lang[i]=='\0')
  {;}
  else if(lang[i]!=',')
  {
   cout<<lang[i];
   c[n-1][j++]=lang[i];
  }
  else if(lang[i]==',')
  {
   count++;
   n++;
   j=0;
   cout<<endl<<n<<".";
  }
  }
  if(count==1)
  {
   k=1;
   goto end;
  }
  char ch;
  cout<<endl<<"Enter your choice:\n ";
  ch=getch();
  if(!isdigit(ch))
  {
   cout<<"\nInvalid Input!";
   delay(1000);
   goto elang;
  }
  if(ch=='\r'||ch=='\b')
 {
  goto elang;
 }
 if(isdigit(ch))
 {
  int t=0;
  for(k=1;k<n+1;k++)
  {
   if((ch-48)!=k)
   {
    t++;
   }
  }
   if(t==n)
   {
   cout<<"\nInvalid Choice!\nEnter again";
    delay(1000);
    goto elang;
   }
 }
 k=ch-48;
 end:
 strcpy(u.lang,c[k-1]);
}
int mldb()
{
 int count=0;char ch,dummy,movie[25],code[100],tempc[100];
 fstream file,file2,filed;
 mov:
 clrscr();
 ch='\0';
 cout<<"\t\t\t       MOVIE DATABASE WINDOW\n\n\n\n\n\n\n\n\n\n";
 cout<<"\t\t\t\t 1.Enter a Movie\n";
 cout<<"\t\t\t\t 2.Display Movies\n";
 cout<<"\t\t\t\t 3.Delete a Movie\n";
 cout<<"\t\t\t\t 4.Go back to User Window\n";
 cout<<"\t\t\t\t 0.Exit";
 ch=getch();
 switch(ch)
 {
  case '1': m.enter();
	    file.open("ldb.dat",ios::app|ios::binary);
	    file.write((char*)&m,sizeof(m));
	    file<<endl;
	    file.close();
	    clrscr();
	    cout<<"Movie is successfully added!";
	    break;
  case '2': case2:
	    file2.open("ldb.dat",ios::in|ios::binary);
	    clrscr();
	    if(!file2)
	    {
	     cout<<"Database not created!";
	     getch();
	     goto mov;
	    }
	    file2.seekg(0,ios::end);
	    if(file2.tellg()==0)
	    {
	     cout<<"Database is empty";
	     getch();
	     goto mov;
	    }
	    file2.seekg(0);
	    while(file2.read((char*)&m2,sizeof(m2)))
	    {
	     file2.get(dummy);
	     m2.display();
	     dummy=getch();
	     if((int)dummy==27)
	     {
	      file2.close();
	      goto mov;
	     }
	    }
	    file2.close();
	    break;
  case '3': clrscr();
	    fstream file3;
	    file3.open("ldb.dat",ios::in|ios::binary);
	    if(!file3)
	    {
	     cout<<"Database not found";
	     getch();
	     file3.close();
	     goto mov;
	    }
	    file3.seekg(0,ios::end);
	    if(file3.tellg()==0)
	    {
	     cout<<"Database is empty";
	     getch();
	     file3.close();
	     goto mov;
	    }
	    file3.seekg(0);
	    cout<<"Enter the Movie code(only numericals): ";
	    gets(code);
	    for(int i=0;i<strlen(code)-1;i++)
	    {
	     if(!isdigit(code[i]))
	     {
	      cout<<"\nInvalid Input!";
	      getch();
	      goto mov;
	     }
	    }
	    filed.open("ldbtemp.dat",ios::out|ios::binary);
	    while(file3.read((char*)&m3,sizeof(m3)))
	    {
	     file3.get(dummy);
	     if(strcmpi(m3.retcode(),code)==0)
	     {
	      char tcode[100],tname[25];
	      strcpy(tname,m3.retname());
	      strcpy(tcode,m3.retcode());
	      puts(tcode);
	      puts(tname);
	      count=1;
	     }
	     else
	     {
	      filed.write((char*)&m3,sizeof(m3));
	      filed<<endl;
	     }
	    }
	    file3.close();
	    if(count!=1)
	    {
	     cout<<"\nNo Movie found!";
	     getch();
	     goto mov;
	    }
	    sure:
	    cout<<"\nDo you really want to delete this movie?\nPress y or n...  ";
	    gets(tempc);
	    if(strcmpi(tempc,"y")==0)
	    {
	     filed.close();
	     remove("ldb.dat");
	     rename("ldbtemp.dat","ldb.dat");
	     cout<<"\nDELETED!";
	     cout<<"\nLoading updated Movie Database...";
	     delay(1200);
	     goto case2;
	    }
	    else if(strcmpi(tempc,"n")==0)
	    {
	     filed.close();
	     remove("ldbtemp.dat");
	     cout<<"\nNOT DELETED";
	    }
	    else
	    {
	     cout<<"\nInvalid Input! Enter Again";
	     goto sure;
	    }
	    break;
  case '4': return 2;
  case '0': return 0;
  default : cout<<"\n\n\t\t\t\t  Invalid input!";
 }
 return 1;
}
void count(char s[12])
{
 fstream f;char ch;int count=0;
 f.open(s,ios::in);
 while(f.get(ch))
 {
  if(ch=='-')
   count++;
 }
 cout<<count;
 f.close();
}
void copy(char chs,char s[12])
{
 fstream f,f2;char ch;
 if(chs=='1')
  f2.open("scrna.txt",ios::in|ios::binary);
 if(chs=='2')
  f2.open("scrnb.txt",ios::in|ios::binary);
 if(chs=='3')
  f2.open("scrnc.txt",ios::in|ios::binary);
 if(chs=='4')
  f2.open("scrnd.txt",ios::in|ios::binary);
 f.open(s,ios::in|ios::nocreate);
 if(!f)
 {
  f.close();
  f.open(s,ios::out|ios::binary);
  while(f2.get(ch))
  {
   f.put(ch);
  }
 }
  f2.close();
  f.close();
}
void entheatre()
{
 fstream f;
 int ti,tn=0,tm=0;
 f.open("TL.dat",ios::binary|ios::out|ios::in);
 for(tm=0;tm<4;tm++)
 {
  cout<<"Location:";
  gets(A.loc);
  ti=1;
  for(tn=0;tn<8;tn++)
  {
   A.no=ti;
   cout<<"Name:";
   gets(A.name);
   ti++;
   f.write((char*)&A,sizeof(A));
   f<<endl;
  }
 }
 f.close();
}
int theatre(int x,char date,char time,char LOC[20])
{
 fstream f;int i;char chl,dummy,cht,chs,t[20],temp[12];
 temp[5]=date;temp[6]=time;temp[7]='.';temp[8]='t';temp[9]='x';temp[10]='t';temp[11]='\0';
 if(x<10)
 {
  temp[3]='0';
  temp[4]=x+48;
 }
 if(x>=10)
 {
  temp[3]=(x/10)+48;
  temp[4]=(x%10)+48;
 }
 if(strcmpi(LOC,"Bengaluru")==0)
  temp[0]='B';
 if(strcmpi(LOC,"Chennai")==0)
  temp[0]='C';
 if(strcmpi(LOC,"Delhi")==0)
  temp[0]='D';
 if(strcmpi(LOC,"Mombayn")==0)
  temp[0]='M';
 thea:
 clrscr();
 puts(::loc);
 puts(u.movie);
 puts(u.lang);
 cout<<date<<" Nov\n";
 if(time=='1')
  cout<<"9 am";
 if(time=='2')
  cout<<"1 pm";
 if(time=='3')
  cout<<"4 pm";
 if(time=='4')
  cout<<"7 pm";
 cout<<endl;
 cout<<"\n\n\t\t\t      <<< MOVIE THEATRES >>>\n\n";
 f.open("TL.dat",ios::binary|ios::out|ios::in);
 while(f.read((char*)&A,sizeof(A)))
 {
  f.get(dummy);
  if(strcmp(A.loc,LOC)==0)
  {
   cout<<"\t\t\t\t "<<A.no<<".";
   puts(A.name);
  }
 }
 f.close();
 cout<<"\n\t\t\t    ";
 textcolor(LIGHTGRAY+BLINK);
 cputs("(Press the Respective Number)");
 textcolor(LIGHTGRAY);
 cht=getch();
 int k=0;
 if(cht=='\r'||cht=='\b')
 {
  goto thea;
 }
 if(isdigit(cht))
 {
  int q=0;
  for(k=1;k<9;k++)
  {
   if((cht-48)!=k)
   {
    q++;
   }
  }
   if(q==8)
   {
    cout<<"\n\n\t\t\t\t    Invalid Choice!\n\t\t\t\t    Enter again";
    delay(1000);
    goto thea;
   }
 }
 if(int(cht)==27)
   return 0;
 if(!isdigit(cht))
 {
  cout<<"\n\n\t\t\t\t    Invalid Choice!\n\t\t\t\t    Enter again";
  delay(1000);
  goto thea;
 }
 f.open("TL.dat",ios::binary|ios::in);
 while(f.read((char*)&A,sizeof(A)))
 {
  f.get(dummy);
  if(strcmp(A.loc,LOC)==0&&(cht-48)==A.no)
  {
   strcpy(t,A.name);
   strcpy(u.thea,A.name);
   break;
  }
 }
 f.close();
 temp[1]=cht;
 screen:
 clrscr();
 puts(::loc);
 puts(u.movie);
 puts(u.lang);
 cout<<date<<" Nov\n";
 if(time=='1')
  cout<<"9 am";
 if(time=='2')
  cout<<"1 pm";
 if(time=='3')
  cout<<"4 pm";
 if(time=='4')
  cout<<"7 pm";
 cout<<endl;
 puts(t);
 cout<<"\n\n\t\t\t\t  << SCREENS >>\n\n";
 for(char chsi='1';chsi-48<5;chsi++)
 {
  temp[2]=chsi;
  strcpy(::scrn,temp);
  copy(chsi,::scrn);
  cout<<"\n\t\t       "<<chsi<<".Screen "<<chsi<<"   (Available Seats: ";
  count(::scrn);
  cout<<")";
 }
 cout<<"\n\n\t\t\t\tEnter your Choice: ";
 chs=getch();
 if(chs=='\r'||chs=='\b')
 {
  goto screen;
 }
 if(isdigit(chs))
 {
  int q=0;
  for(k=1;k<5;k++)
  {
   if((chs-48)!=k)
   {
    q++;
   }
  }
   if(q==4)
   {
    cout<<"\n\n\t\t\t\t    Invalid Choice!\n\t\t\t\t    Enter again";
    delay(1000);
    goto screen;
   }
 }
 if(int(chs)==27)
   goto thea;
 if(!isdigit(chs))
 {
  cout<<"\n\n\t\t\t\t    Invalid Choice!\n\t\t\t\t    Enter again";
  delay(1000);
  goto screen;
 }
 temp[2]=chs;
 u.scrnno=temp[2]-48;
 strcpy(scrn,temp);
 return 1;
}
int dt(int q=0)
{
 char tempd,tempt;int k=0;
 dat:
 if(q==0)
 {
 clrscr();
 puts(::loc);
 puts(u.movie);
 puts(u.lang);
 cout<<"\n\n\n\n";
 for(int i=1;i<8;i++)
 {
  cout<<endl<<"\t\t\t\t   "<<i<<" Nov 2019";
 }
 cout<<"\n\n\t\t\t";
 textcolor(LIGHTGRAY+BLINK);
 cputs("Choose your date(Eg,3 Nov 2019)-->3)");
 textcolor(LIGHTGRAY);
 tempd=getch();
 if(tempd=='\r'||tempd=='\b')
 {
  goto dat;
 }
 if(isdigit(tempd))
 {
  int t=0;
  for(k=1;k<8;k++)
  {
   if((tempd-48)!=k)
   {
    t++;
   }
  }
   if(t==7)
   {
    cout<<"\n\n\t\t\t\t    Invalid Choice!\n\t\t\t\t    Enter again";
    delay(1000);
    goto dat;
   }
 }
 if(int(tempd)==27)
   return 0;
 if(!isdigit(tempd))
 {
  cout<<"\n\n\t\t\t\t    Invalid Choice!\n\t\t\t\t    Enter again";
  delay(1000);
  goto dat;

 }
 ::date=tempd;
 q=1;
 }
 if(q==1)
 {
 tim:
 clrscr();
 puts(::loc);
 puts(u.movie);
 puts(u.lang);
 cout<<::date<<" Nov";
 cout<<"\n\n\n\n\n";
 cout<<"\n\t\t\t\t     1.9 am";
 cout<<"\n\t\t\t\t     2.1 pm";
 cout<<"\n\t\t\t\t     3.4 pm";
 cout<<"\n\t\t\t\t     4.7 pm\n";
 cout<<"\n\t\t\t\tEnter your Choice: ";
 tempt=getch();
 if(tempt=='\r'||tempt=='\b')
 {
  goto tim;
 }
 if(isdigit(tempt))
 {
  int t=0;
  for(k=1;k<5;k++)
  {
   if((tempt-48)!=k)
   {
    t++;
   }
  }
   if(t==4)
   {
    cout<<"\n\n\t\t\t\t   Invalid Choice!\n\t\t\t\t     Enter again";
    delay(1000);
    goto tim;
   }
 }
 ::timee=tempt;
 }
 if(int(tempt)==27)
 {
  q=0;
  goto dat;
 }
 if(!isdigit(tempt))
 {
  cout<<"\n\n\t\t\t\t   Invalid Choice!\n\t\t\t\t      Enter again";
  delay(1000);
  goto tim;

 }
 return 1;
}
void LOCATION()
{
 char templ[20];
 loca:
 clrscr();
  cout<<"\t\t\t    WELCOME TO ORIENTAL CINEMA!!!\n";
 cout<<"\n\n\n\n\n\n\n\n\t\t\t    ";
 textcolor(LIGHTGRAY+BLINK);
 cputs("Please choose your location\n");
 textcolor(LIGHTGRAY);
 cout<<"\n\t\t\t\t   - Bengaluru -";
 cout<<"\n\t\t\t\t    - Chennai -";
 cout<<"\n\t\t\t\t     - Delhi -";
 cout<<"\n\t\t\t\t    - Mombayn -\n";
 cout<<"\n\t\t\t ";
 cout<<"Enter your Choice(if Chennai->2): ";
 gets(templ);
 int k=0;
 if(strlen(templ)==1)
 {
  if(!isdigit(templ[0]))
  {
   k=1;
  }
 }
 if(templ[0]-48<=0||templ[0]-48>4)
 {
  k=1;
 }
 if(k==1||strlen(templ)>1)
 {
  cout<<"\n\t\t\t\t  Invalid Choice!\n\t\t\t\t   Choose again";
  delay(1005);
  goto loca;
 }
 if(templ[0]=='1')
  strcpy(templ,"Bengaluru");
 if(templ[0]=='2')
  strcpy(templ,"Chennai");
 if(templ[0]=='3')
  strcpy(templ,"Delhi");
 if(templ[0]=='4')
  strcpy(templ,"Mombayn");
 strcpy(::loc,templ);
}
int movieslist()
{
 clrscr();
 int N=0,i=1,n=0;char dummy,ch[100],movie[30];
 fstream file,file2,file3,file4,file5,sfile;
 sfile.open("ldb.dat",ios::in,ios::binary);
 file.open("movies.dat",ios::out,ios::binary);
 while(sfile.read((char*)&m4,sizeof(m4)))
 {
  sfile.get(dummy);
  strcpy(M.retmovie(),m4.retname());
  file.write((char*)&M,sizeof(M));
  n++;
 }
 sfile.close();
 file.close();
 mov:
 strcpy(ch,"\0");
 clrscr();
 i=1;
 file2.open("movies.dat",ios::in|ios::binary);
 cout<<"Movies running now:\n";
 while(file2.read((char*)&M2,sizeof(M2)))
 {
   cout<<i++<<".";
   M2.display();
 }file2.close();
 file3.open("movies.dat",ios::in|ios::binary);
 cout<<"0.Go Back\nEnter your Choice: ";
 gets(ch);
 int k,l;
 do
 {
  k=l=0;
  if(strlen(ch)==0||strlen(ch)>2)
  {
   k=1;
   continue;
  }
  for(i=0;i<strlen(ch)-1&&k!=1;i++)
  {
   if(!isdigit(ch[i]))
   {
    k=1;
    continue;
   }
  }
  if(ch[0]=='0')
   return 0;
  if(k==1)
   continue;
  int z=0;
  N=0;
  for(i=strlen(ch)-1;i>=0;i--)
  {
   N=N+(ch[i]-48)*pow(10,z++);
  }
  if(N>n)
   {k=1;
    continue;}
  l++;
}while(k!=1&&l==0);
  if(k==1)
  {
   cout<<"\nInvalid Input!";
   getch();
   file3.close();
   goto mov;
  }
 file3.close();
 file4.open("movies.dat",ios::in|ios::binary);
 file4.seekg(30*(N-1),ios::beg);
 file4.read((char*)&M3,sizeof(M3));
 strcpy(movie,M3.retmovie());
 strcpy(u.movie,movie);
 file4.close();
 file5.open("ldb.dat",ios::in|ios::binary);
 while(file5.read((char*)&m4,sizeof(m4)))
 {
  file5.get(dummy);
  if(!strcmp(u.movie,m4.retname()))
  {
   file5.close();
   break;
  }
 }
 disp:
 clrscr();
 m4.display(1);
 cout<<endl;
 textcolor(LIGHTGRAY+BLINK);
 cputs("Press 1 to BOOK Tickets");
 cout<<endl;
 cputs("Press 0 to Go BACK");
 textcolor(LIGHTGRAY);
 char m=getch();
 if(m=='0')
  goto mov;
 if(m!='1'&&m!='0')
  goto disp;
 m4.language();
 return N;
}
void cancel(long int N)
{
 fstream user,file,temp;
 char scrn[12];int i=0,i1=0,i2=0;
 char ch,a[50][50];
 user.open(::name,ios::in|ios::binary);
 while(user.read((char*)&u2,sizeof(u2)))
 {
  if(N==u2.N)
  {
   strcpy(scrn,u2.scrn);
   if(u2.status!=0)
   {
    i1=1;
   }
   else
   {
    cout<<"\n\n\n\n\n\n\n\n\t          This Booking is unavailable for Cancellation!";
    getch();
    i2=1;
   }
   break;
  }
 }
 user.close();
 if(i1==0&&i2==0)
 {
  cout<<"\n\n\n\n\n\n\n\n\t\t         Booking details Not found!";
  getch();
 }
 if(i1==1&&i2==0)
 {
 file.open(scrn,ios::in);
 temp.open("tempsc.txt",ios::out);
 for(i=0;i<u2.in;i++)
 {
  for(int j=0;j<u2.jn;j++)
  {
   file.get(ch);
    if(ch!='\n')
     a[i][j]=ch;
    else
     {
      file.get(ch);
      a[i][j]=ch;
     }
   if(u2.a[i][j]==a[i][j])
   {
    a[i][j]='-';
   }
   temp.put(a[i][j]);
  }
  if(i!=(u2.in-1))
   temp<<endl;
 }
 file.close();
 temp.close();
 confirm:
 clrscr();
 cout<<"Order No: "<<u2.N<<endl;
 cout<<"Status: On";
 cout<<endl;
 cout<<"Location: ";puts(u2.loc);
 cout<<"Movie: ";puts(u2.movie);
 cout<<"Language: ";puts(u2.lang);
 cout<<"Theatre: ";puts(u2.thea);\
 cout<<"Screen: "<<u2.scrnno<<endl;
 cout<<"Total Seats Booked: "<<u2.seat<<endl;
 cout<<"Seats Booked: ";
 for(i=0;i<u2.in;i++)
 {
  for(int j=0;j<u2.jn;j++)
  {
   if(u2.a[i][j]=='*')
   {
    cout<<char((j/2)+65)<<(i+1)<<",";
   }
  }
 }cout<<"\b \b\n";
 cout<<"Date: "<<u2.date<<" Nov\n";
 cout<<"Time: ";
 if(u2.timee==1)
  cout<<"9 am";
 if(u2.timee==2)
  cout<<"1 pm";
 if(u2.timee==3)
  cout<<"4 pm";
 if(u2.timee==4)
  cout<<"7 pm";
 cout<<endl;
 cout<<"Amount: "<<u2.amount<<endl;
 cout<<"Payment: ";
 if(u2.Paid=='Y')
  cout<<"Paid";
 else
  cout<<"Not Paid";
 cout<<endl<<endl;
 cout<<"\n\nDo You Want to cancel for Sure?(y/n)";
 ch=getch();
 if(ch=='y'||ch=='Y')
 {
  remove(scrn);
  rename("tempsc.txt",scrn);
  user.open(::name,ios::in|ios::out|ios::binary);
  while(user.read((char*)&u3,sizeof(u3)))
  {
   if(N==u3.N)
   {
    int pos=user.tellg();
    user.seekp(pos-sizeof(u3),ios::beg);
    u3.status=0;
    user.write((char*)&u3,sizeof(u3));
    break;
   }
  }
  user.close();
  clrscr();
  cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t    Cancelled!";
  getch();
 }
 else if(ch=='n'||ch=='N')
 {
  remove("tempsc.txt");
  clrscr();
  cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t   Not Cancelled!";
  getch();
 }
 else
  goto confirm;
}
}
void main()
{
 clrscr();
 char oc[2]={3,'\0'};
 textcolor(WHITE);
 cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t";
 cputs(oc);
 cputs(" ORIENTAL CINEMAS ");
 cputs(oc);
 textcolor(LIGHTGRAY);
 getch();
 load(0);
 clrscr();
 LOCATION();
 int i=0;char ch='\0';
 oc[0]=4;
 ls:
 clrscr();
 cout<<"\t\t\t        ";
 textbackground(WHITE);
 textcolor(BLACK);
 cputs(oc);
 cputs(" ORIENTAL CINEMAS ");
 cputs(oc);
 textbackground(BLACK);
 textcolor(LIGHTGRAY);
 cout<<"\n\n\n\n\n\n\n\n\n\n";
 cout<<"\t\t\t\t    1.Login\n";
 cout<<"\t\t\t\t    2.Signup\n";
 cout<<"\t\t\t\t    3.See Movies\n";
 cout<<"\t\t\t\t    0.Exit";
 textcolor(LIGHTGRAY);
 ch=getch();
 if(ch=='\r'||int(ch)==27||ch=='\b')
 {
  goto ls;
 }
 if((!isdigit(ch))||ch!='1'&&ch!='2'&&ch!='3'&&ch!='0')
 {
  clrscr();
  if(int(ch)==127)
   ;
  if(int(ch)!=127)
  {
   cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t  Invalid Input!\n";
   cout<<"\t\t\t\t   Enter again..";
   getch();
   goto ls;
  }
 }
 switch(ch)
 {
  case '1':i=l.login();
	   if(i==0)
	    goto ls;
	   if(i==1)
	    ::w=1;
	   clrscr();
	   for(int j=0;;j++)
	   {
	    if(::nun[j]=='\0')
	    {
	     ::nun[j]='!';
	     ::nun[j+1]='\0';
	     break;
	    }
	   }
	   l:
	   clrscr();
	   cout<<"\t\t\t\t << User Window >>\n\n";
	   cout<<"Welcome Back ";
	   puts(::nun);
	   cout<<endl;
	   cout<<"1.Book Tickets\n";
	   cout<<"2.View all your Bookings\n";  //Purchase History
	   cout<<"3.Cancel your Bookings\n";
	   cout<<"4.Sign out\n";
	   cout<<"0.Exit\n";
	   cout<<endl;
	   textcolor(LIGHTGRAY+BLINK);
	   cputs("(Press 1,2,3,4 or 0)");
	   textcolor(LIGHTGRAY);
	   ch=getch();
	   if(!isdigit(ch)||ch!='1'&&ch!='2'&&ch!='3'&&ch!='4'&&ch!='0')
	   {
	    clrscr();
	    cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t\t\t  Invalid Input!\n";
	    cout<<"\t\t\t\t   Enter again..";
	    getch();
	    goto l;
	   }
	   switch(ch)
	   {
	    case '1':int k=0;
		     movl:
		     j=movieslist();
		     if(j==0)
		      goto l;
		     dth:
		     if(k==0)
		     {
		      i=dt();
		      if(i==0)
		       goto movl;
		     }
		     if(k==1)
		     {
		      i=dt(1);
		      if(i==0)
		      {
		       k=0;
		       goto movl;
		      }
		     }
		     i=theatre(j,::date,::timee,::loc);
		     if(i==0)
		     {
		      k=1;
		      goto dth;
		     }
		     j=seatselect();
		     if(j==0)
		     {
		      load(4);
		      goto l;
		     }
		     goto l;
	    case '2':clrscr();
		     fstream user;
		     user.open(::name,ios::in|ios::binary);
		     if(!user)
		     {
		      cout<<"\n\n\n\n\n\n\n\n\n\n\n\t\t    ";
		      cout<<"Looks like you don't have any upcoming movies";
		      user.close();
		      getch();
		      goto l;
		     }
		     cout<<"\t\t\t\t<< Purchase History >>\n\n";
		     while(user.read((char*)&u2,sizeof(u2)))
		     {
		      cout<<"Order No: "<<u2.N<<endl;
		      cout<<"Status: ";
		      if(u2.status==1)
		       cout<<"On";
		      if(u2.status==0)
		       cout<<"Cancelled";
		      cout<<endl;
		      cout<<"Location: ";puts(u2.loc);
		      cout<<"Movie: ";puts(u2.movie);
		      cout<<"Language: ";puts(u2.lang);
		      cout<<"Theatre: ";puts(u2.thea);\
		      cout<<"Screen: "<<u2.scrnno<<endl;
		      cout<<"Total Seats Booked: "<<u2.seat<<endl;
		      cout<<"Seats Booked: ";
		      for(i=0;i<u2.in;i++)
		      {
		       for(j=0;j<u2.jn;j++)
		       {
			if(u2.a[i][j]=='*')
			{
			 cout<<char((j/2)+65)<<(i+1)<<",";
			}
		       }
		      }cout<<"\b \b\n";
		      cout<<"Date: "<<u2.date<<" Nov\n";
		      cout<<"Time: ";
		      if(u2.timee==1)
		       cout<<"9 am";
		      if(u2.timee==2)
		       cout<<"1 pm";
		      if(u2.timee==3)
		       cout<<"4 pm";
		      if(u2.timee==4)
		       cout<<"7 pm";
		      cout<<endl;
		      cout<<"Amount: "<<u2.amount<<endl;
		      cout<<"Payment: ";
		      if(u2.Paid=='Y')
		       cout<<"Paid";
		      else
		       cout<<"Not Paid";
		      cout<<endl<<endl;
		      getch();
		     }
		     user.close();
		     goto l;
	    case '3':clrscr();
		     long int N=0;char ch[100];int x=0;
		     do
		     {
		      cout<<"\t\t\t\t    << Cancellation >>\n\n";
		      cout<<"Enter your Order No: ";
		      gets(ch);
		      for(int k=0;k<strlen(ch)-1;k++)
		      {
		       if(!isdigit(ch[k]))
		       {
			x=1;
		       }
		      }
		     }while(x==1);
		     int z=0;
		     for(i=strlen(ch)-1;i>=0;i--)
		     {
		      N=N+(ch[i]-48)*pow(10,z++);
		     }
		     cancel(N);
		     goto l;
	    case '4':load(2);
		     goto ls;
	    case '0':load(3);
		     exit(0);
	   }
	   break;
  case '2':i=s.signup();
	   if(i==0)
	    goto ls;
	   if(i==1)
	   {
	    ::w=1;
	   }
	   for(j=0;;j++)
	   {
	    if(::nun[j]=='\0')
	    {
	     ::nun[j]='!';
	     ::nun[j+1]='\0';
	     break;
	    }
	   }
	   clrscr();
	   cout<<"\t\t\t\t << User Window >>\n\n";
	   cout<<"Welcome  ";
	   puts(::nun);
	   cout<<endl;
	   goto l;
  case '3':int k=0,q=0;
	   movd:
	   j=movieslist();
	   if(j==0)
	    goto ls;
	   dth2:
	   if(k==0&&q==0)
	   {
	    i=dt();
	    if(i==0)
	     goto movd;
	   }
	   if(k==1)
	   {
	    i=dt(1);
	    if(i==0)
	    {
	     k=0;
	     goto movd;
	    }
	   }
	   i=theatre(j,::date,::timee,::loc);
	   if(i==0)
	   {
	     k=1;
	     goto dth2;
	   }
	   j=seatselect();
	   if(j==0)
	   {
	    load(4);
	    goto ls;
	   }
	   goto l;
  case 127:load(0);
	   admin:
	   clrscr();
	   i=a.login(1);
	   if(i==0)
	    goto admin;
	   admin2:
	   i=mldb();
	   if(i==0)
	   {
	    load(2);
	    load(3);
	    exit(0);
	   }
	   if(i==2)
	   {
	    load(0);
	    goto ls;
	   }
	   goto admin2;
  case '0':load(3);
	   exit(0);
 }
 getch();
}